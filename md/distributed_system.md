# 分布式系统(distributed system)

## 什么是分布式系统？

分布式系统是由一组通过网络进行通信、为了完成共同的任务而**协调工作**的计算机节点组成的系统。分布式系统的出现是为了用廉价的、普通的机器完成单个计算机无法完成的计算、存储任务。其目的是**利用更多的机器，处理更多的数据**。

单机系统：一个项目所有的代码都放在一台服务器上，所有的服务都由这台服务器提供。单机系统的处理请求和存储数据的能力有限，且一旦此台服务器宕机，服务就挂了。

集群系统：当单机系统的性能达到瓶颈的时候，把单机复制几份，就构成了“集群”。集群中的每台服务器称为一个节点，每个节点提供**相同**的服务，相当于系统的处理能力提升了好几倍。 --> 如何决定由哪个节点处理请求，负载均衡服务器。(Nginx) 集群系统容易扩展，随着业务的发展，可直接向集群中添加节点即可。 

而分布式结构就是将一个完整的系统，按照业务功能，拆分成一个个独立的子系统，在分布式结构中，每个子系统就被称为“子服务”。这些子系统能够独立运行在web容器中，它们之间又能进行通信。这样做的好处很多，可以降低系统的耦合性（每个子系统独立进行开发、测试和部署）、业务的服务易于拓展。但同时，分布式系统多节点协作、各节点拓扑结构，会引入很多单机系统没有的问题，为了解决这些问题又会引入更多的机制、协议，带来更多的问题。


![](https://upload-images.jianshu.io/upload_images/4440914-47906d7c5db0041f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


为什么要有分布式系统：

1. 单个节点的处理能力无法满足日益增长的计算、存储任务； 

2. 硬件的提升（加内存、加磁盘、使用更好的CPU）高昂到得不偿失；

3. 应用程序无法进一步优化； 


分布式系统面临的挑战：

1. 异构的机器与网络： 

2. 普遍的节点故障： 

3. 不可靠的网络： 

总而言之，分布式的挑战来自**不确定性**。 


## CAP定理 

CAP原则又称CAP定理，指的是在一个分布式系统中，Consistency（一致性）、 Availability（可用性）、Partition tolerance（分区容错性）这三个基本需求，最多只能同时满足其中的2个。 



|选项|描述|
|  --  |  --  | 
|Consistency（一致性）|指数据在多个副本之间能够保持一致的特性（严格的一致性）| 
|Availability（可用性）|指系统提供的服务必须一直处于可用的状态，每次请求都能获取到非错的响应（不保证获取的数据为最新数据）|
|Partition tolerance（分区容错性）|分布式系统在遇到任何网络分区故障的时候，仍然能够对外提供服务，除非整个网络环境都发生了故障| 



**CA without P**

如果不要求P（不允许分区），则C（强一致性）和A（可用性）是可以保证的。但其实分区不是你想不想的问题，而是始终会存在，因此CA的系统更多的是允许分区后各子系统依然保持CA。

**CP without A** 

如果不要求A（可用），相当于每个请求都需要在Server之间强一致，而P（分区）会导致同步时间无限延长，如此CP也是可以保证的。很多传统的数据库分布式事务都属于这种模式，在网络故障时只读不写。

**AP wihtout C** 

要高可用并允许分区，则需放弃一致性。一旦分区发生，节点之间可能会失去联系，为了高可用，每个节点只能用本地数据提供服务，而这样会导致全局数据的不一致性。现在众多的NoSQL都属于此类。


### mapreduce -- 分布式运算模型


[MapReduce]()


![](https://upload-images.jianshu.io/upload_images/4440914-5e54669407edcb40.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)  


### raft -- 分布式一致性算法

[raft动画](http://thesecretlivesofdata.com/raft/?utm_source=hacpai.com)






